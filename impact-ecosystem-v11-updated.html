
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Impact Investing Ecosystem - Explorer (v10)</title>
<link href="https://fonts.googleapis.com/css2?family=Familjen+Grotesk:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --brand-dk:#1E2951; --brand-grn:#0F7938; --brand-ylw:#D4AF37; --brand-lbl:#6FBFB3;
  --ink:#1E2951; --ink-2:#33406f; --muted:#5c6b9b; --bg:#ffffff; --surface:#f6f8fb;
  --card:#ffffff; --line:#e4e8f2; --ok:#0F7938;
  --shadow:0 10px 30px rgba(0,0,0,.08); --radius:14px;
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;background:var(--bg); color:var(--ink);
  font:15px/1.55 "Familjen Grotesk", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;}
header{position:sticky; top:0; z-index:50; background:#fff; border-bottom:1px solid var(--line)}
.wrap{max-width:1280px; margin:0 auto; padding:12px 18px; display:flex; gap:10px; align-items:center; flex-wrap:wrap}
.brand{width:24px; height:24px; border-radius:6px; background:conic-gradient(from 90deg, var(--brand-dk), var(--brand-lbl), var(--brand-ylw), var(--brand-grn)); border:1px solid var(--line)}
.kicker{font-size:12px; font-weight:700; letter-spacing:.08em; text-transform:uppercase; color:var(--muted)}
.controls{margin-left:auto; display:flex; gap:8px; flex-wrap:wrap}
.btn{background:#fff; color:var(--ink); border:1px solid var(--line); padding:9px 12px; font-weight:700; border-radius:10px; cursor:pointer; transition:.2s}
.btn:hover{transform:translateY(-1px); box-shadow:0 4px 14px rgba(0,0,0,.08)}
.btn.primary{background:var(--brand-grn); color:#fff; border:none}
.btn.ghost{background:#fff; border:1px dashed var(--line); color:var(--ink-2)}

main{max-width:1280px; margin:18px auto 40px; padding:0 18px; display:grid; grid-template-columns:280px 1fr; gap:16px}
aside{position:sticky; top:66px; align-self:start; background:#fff; border:1px solid var(--line); border-radius:14px; padding:12px; box-shadow:var(--shadow)}
.nav{display:grid; gap:6px}
.nav button{width:100%; text-align:left; background:#fff; color:var(--ink); border:1px solid var(--line); padding:10px 12px; border-radius:10px; cursor:pointer}
.nav button.active{outline:2px solid var(--brand-lbl)}
.section{display:none}
.section.active{display:block}

.search{position:relative; margin-top:10px}
.search input{width:100%; background:#fff; border:1px solid var(--line); border-radius:12px; color:var(--ink); padding:10px 12px 10px 36px}
.search svg{position:absolute; left:10px; top:9px; width:18px; height:18px; opacity:.65; color:var(--muted)}

.lens{margin-top:10px; display:flex; flex-wrap:wrap; gap:8px}
.chip{border:1px solid var(--line); background:#fff; border-radius:999px; padding:6px 10px; font-size:12px; color:var(--ink-2); cursor:pointer}
.chip.active{background:var(--brand-lbl); color:#08363a; border-color:var(--brand-lbl)}

.legend{margin-top:14px; display:grid; grid-template-columns:1fr 1fr; gap:8px; font-size:12px; color:var(--ink-2)}
.legend .dot{width:10px; height:10px; border-radius:999px; display:inline-block; margin-right:8px}
.a1{background:var(--brand-grn)} .a2{background:var(--brand-lbl)} .a3{background:var(--brand-ylw)} .a4{background:var(--brand-dk)} .a5{background:#9AA6D1}

.grid{display:grid; grid-template-columns:repeat(5, minmax(220px, 1fr)); gap:14px}
.col{background:#fff; border:1px solid var(--line); border-radius:14px; padding:12px; box-shadow:var(--shadow)}
.col h3{margin:0 0 6px 4px; font-size:13px; text-transform:uppercase; letter-spacing:1px; color:var(--muted)}
.col .sub{margin:0 0 10px 4px; color:#7a87b7; font-size:12px}
.list{display:grid; gap:10px}
.card{background:var(--card); border:1px solid var(--line); border-radius:12px; padding:10px; cursor:pointer; transition:.2s}
.card:hover{transform:translateY(-2px); border-color:var(--brand-lbl); background:#f7fbfb}
.card .title{font-weight:800; font-size:13px}
.card .meta{color:#6a789f; font-size:12px; margin-top:4px}
.dim{opacity:.25; filter:saturate(.6)}

.panel{background:#fff; border:1px solid var(--line); border-radius:14px; padding:14px; box-shadow:var(--shadow)}

.details{position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(10,18,40,.25); z-index:100}
.details.open{display:flex}
.sheet{width:min(980px, 94vw); max-height:88vh; overflow:auto; background:#fff; border:1px solid var(--line); border-radius:16px; box-shadow:0 24px 80px rgba(0,0,0,.18)}
.sheet header{position:sticky; top:0; background:#fff; border-bottom:1px solid var(--line); padding:12px 16px; z-index:2}
.sheet h2{margin:0; font-size:18px}
.sheet .content{padding:14px; display:grid; gap:12px}
.block{border:1px dashed var(--line); border-left:0; border-right:0; padding:10px 0}
.block h4{margin:0 0 6px; font-size:13px; text-transform:uppercase; letter-spacing:1px; color:var(--muted)}
.p{color:#1e2951; font-size:14px}
.badge{display:inline-block; min-width:34px; text-align:center; padding:3px 6px; border-radius:999px; background:#eef6ff; border:1px solid var(--line); color:#0f2a65; font-weight:800}
.dep{display:inline-block; border:1px dashed var(--brand-lbl); padding:5px 8px; border-radius:999px; font-size:12px; color:#08363a; background:#e7f7f6; cursor:pointer}
.dep:hover{background:#d6f1ef}

.subgrid{display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:10px}
.subcard{background:#fff; border:1px solid var(--line); border-radius:12px; padding:10px}
.subcard h5{margin:0 0 4px; font-size:13px}
.subcard .mini{color:#6a789f; font-size:12px}
.subcard ul{margin:6px 0 0 18px; padding:0; color:#1e2951; font-size:13px}

.close{position:absolute; right:14px; top:10px; background:transparent; border:0; color:#6a789f; font-size:22px; cursor:pointer}

footer{max-width:1280px; margin:22px auto 50px; padding:0 18px; color:#5c6b9b; font-size:12px}
.kbd{border:1px solid var(--line); background:#fafbfe; padding:1px 6px; border-radius:6px; font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size:12px; color:#1e2951}

/* Strategies tab */
.strategy{background:#fff; border:1px solid var(--line); border-radius:12px; padding:14px; margin-bottom:12px; box-shadow:var(--shadow)}
.strategy h3{margin:0 0 6px; font-size:18px}
.strategy .desc{color:#1e2951}
.chips{display:flex; flex-wrap:wrap; gap:6px; margin-top:8px}
.stake{display:inline-flex; align-items:center; gap:6px; border:1px solid var(--line); background:#fff; border-radius:999px; padding:4px 8px; font-size:12px; cursor:pointer}
.stake[data-seg="supply"]{border-color:var(--brand-grn); color:var(--brand-grn)}
.stake[data-seg="aggs"]{border-color:var(--brand-lbl); color:#0a5b5d}
.stake[data-seg="seek"]{border-color:var(--brand-ylw); color:#8a6b05}
.stake[data-seg="enab"]{border-color:var(--brand-dk); color:var(--brand-dk)}
.stake[data-seg="infra"]{border-color:#9AA6D1; color:#3b4b87}

.cs{margin-top:10px; border-top:1px dashed var(--line); padding-top:8px}
.cs h4{margin:2px 0 6px; font-size:14px; letter-spacing:.02em; color:#31406b}
.cs .flow{display:grid; grid-template-columns:repeat(4,1fr); gap:8px}
.cs .box{border:1px solid var(--line); border-radius:10px; padding:10px; background:#fafbfe; font-size:13px}
.cs .step{font-weight:800; color:#0F7938}
.cs .tags{margin-top:6px; display:flex; flex-wrap:wrap; gap:6px}

.alert{border-left:4px solid var(--brand-grn); background:#f4fbf6; padding:10px; border-radius:8px; color:#0f3a1f}
.strategy-actions{display:flex; gap:8px; flex-wrap:wrap; margin:8px 0 4px}

/* Georgia tab styles */
.ga-map{height:420px; border-radius:12px; overflow:hidden; border:1px solid var(--line)}
.ga-stats{display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:10px; margin:12px 0}
.stat{display:flex; align-items:center; gap:10px; border:1px solid var(--line); border-radius:14px; padding:12px; background:linear-gradient(135deg, rgba(15,121,56,.05), rgba(31,41,81,.05))}
.stat .glyph{width:40px; height:40px; border-radius:10px; background:var(--brand-grn); color:#fff; display:flex; align-items:center; justify-content:center; font-weight:800; padding:8px}
.stat .glyph svg{width:100%; height:100%}
.stat .meta .label{font-size:12px; color:#4a5a8c; text-transform:uppercase; letter-spacing:.04em; font-weight:800}
.stat .meta .value{font-size:22px; font-weight:800; color:var(--brand-dk)}

.embedwrap{border:1px solid var(--line); border-radius:12px; overflow:hidden; background:#fff}
.embedbar{display:flex; justify-content:space-between; align-items:center; gap:8px; padding:8px 10px; background:#f8fafc; border-bottom:1px solid var(--line)}
.embedframe{width:100%; height:3000px; border:0}
.note{font-size:12px; color:#4a5a8c; margin-top:8px}
.no-print{display:inline-block}

/* Print */
@media print{
  header, aside, #exportPrint, #resetView, #how { display:none !important; }
  main{ grid-template-columns:1fr; }
}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="brand" aria-hidden="true"></div>
    <div class="kicker">Impact Investing Ecosystem</div>
    <div class="controls">
      <button class="btn primary" id="resetView">Reset View</button>
      <button class="btn" id="exportPrint">Print</button>
      <button class="btn ghost" id="how">How to</button>
    </div>
  </div>
</header>

<main>
  <aside>
    <div class="nav">
      <!-- Reordered: Map â†’ Strategies â†’ Glossary -->
      <button class="active" data-view="map">Map</button>
      <button data-view="strategies">Strategies</button>
      <button data-view="georgia">Georgia</button>
      <button data-view="glossary">Glossary</button>
    </div>

    <div class="search">
      <svg viewBox="0 0 24 24" fill="currentColor"><path d="M15.5 14h-.79l-.28-.27a6.5 6.5 0 10-.71.71l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0a4.5 4.5 0 110-9 4.5 4.5 0 010 9z"/></svg>
      <input id="q" placeholder="Search names, roles, capacities, challenges..." aria-label="Search">
    </div>

    <div class="lens" id="lens">
      <div class="chip active" data-fn="all">All functions</div>
      <div class="chip" data-fn="provision">Capital Provision</div>
      <div class="chip" data-fn="origination">Deal Origination</div>
      <div class="chip" data-fn="execution">Evaluation & Execution</div>
      <div class="chip" data-fn="opportunity">Opportunity Development</div>
    </div>

    <div class="legend">
      <div><span class="dot a1"></span> Capital Supply</div>
      <div><span class="dot a2"></span> Aggregators</div>
      <div><span class="dot a3"></span> Seekers</div>
      <div><span class="dot a4"></span> Enablers</div>
      <div><span class="dot a5"></span> Infrastructure</div>
    </div>

    <div style="margin-top:10px; color:#6a789f; font-size:12px">
      Tip: Use the Function Lens to spotlight who performs <em>Provision / Origination / Execution / Opportunity Development</em>. Click a card to open a Details Sheet. Close the sheet or hit <strong>Reset View</strong> to return to default.
    </div>
  </aside>

  <section>
    <!-- MAP VIEW -->
    <div id="view-map" class="section active">
      <div class="grid" id="grid"><!-- columns built by JS --></div>
      <div class="panel" style="margin-top:14px">
        <strong>About this view.</strong>
        The four core functions-Capital Provision, Deal Origination & Sourcing, Deal Evaluation/Structuring/Execution, and Opportunity Development-operate across five stakeholder segments; Infrastructure cuts across all. Use the lens to see who does what; open any card for descriptions, capacities, bottlenecks, sub-categories, and relationship dependencies.
      </div>
    </div>

    <!-- STRATEGIES VIEW -->
    <div id="view-strategies" class="section">
      <div class="panel alert">Strategies describe <em>how</em> money moves for impact. Each strategy nests stakeholders from the Map and includes detailed, step-by-step examples you can reuse in workshops. Use the â€œDownload Strategy Briefâ€ to export all examples for printing.</div>
      <div id="strategiesList"></div>
    </div>

    <!-- GEORGIA VIEW -->
    <div id="view-georgia" class="section">
      <div class="panel">
        <div class="ga-map">
          <iframe src="https://www.google.com/maps/d/embed?mid=1-6Rhs_g9H_Oxnk-8O51TWF1zNIOCk7c&ehbc=2E312F" width="100%" height="100%" style="border:0; border-radius:12px;"></iframe>
        </div>
        
        <div class="ga-stats" id="gaStats"></div>
        
        <div class="embedwrap" style="margin-top:12px">
          <div class="embedbar">
            <div><strong>Georgia's Impact Investing Ecosystem</strong> – embedded from your Softr site</div>
            <div class="no-print">
              <a class="btn" href="https://ga-impact-investing-ecosystem.softr.app/" target="_blank" rel="noopener">Open in new tab</a>
            </div>
          </div>
            <iframe class="embedframe" id="softrFrame" src="https://ga-impact-investing-ecosystem.softr.app/" title="Georgia Ecosystem"></iframe>
        </div>
        <div class="note">If the embedded page doesn't display due to browser restrictions, use "Open in new tab."</div>
      </div>
    </div>

    <!-- GLOSSARY VIEW (now last) -->
    <div id="view-glossary" class="section">
      <div class="panel" id="glossary"></div>
    </div>
  </section>
</main>

<div class="details" id="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
  <div class="sheet">
    <header>
      <button class="close" aria-label="Close" id="closeModal">âœ•</button>
      <h2 id="modalTitle">Details</h2>
    </header>
    <div class="content" id="modalBody"></div>
  </div>
</div>

<footer>
  All data lives in <span class="kbd">dataV10</span> below-edit in a text editor to tailor to your partners.
</footer>

<script>
// ---------------------- DATA (v10) ------------------------------
var dataV10 = {
  functions: [
    {key:'provision', label:'Capital Provision', desc:'Who controls and deploys investment capital.'},
    {key:'origination', label:'Deal Origination & Sourcing', desc:'Who finds and develops investment opportunities.'},
    {key:'execution', label:'Evaluation, Structuring & Execution', desc:'Who evaluates risk/impact, structures terms, and completes transactions.'},
    {key:'opportunity', label:'Opportunity Development', desc:'Who helps capital seekers succeed and scale impact.'}
  ],
  segments: [
    { key:'supply', label:'Capital Supply', color:'var(--brand-grn)' },
    { key:'aggs',   label:'Capital Aggregators', color:'var(--brand-lbl)' },
    { key:'seek',   label:'Capital Seekers', color:'var(--brand-ylw)' },
    { key:'enab',   label:'Capital Enablers', color:'var(--brand-dk)' },
    { key:'infra',  label:'Infrastructure', color:'#9AA6D1' },
  ],
  // --- Nodes (copied from v9 with minor label polish) ---
  nodes: [
    { id:'inst_owners', seg:'supply', fn:['provision'],
      title:'Institutional Asset Owners', meta:'Mandates, large-scale capital',
      keyFunction:'Provide patient, institutional capital to impact strategies.',
      descLong:'Large fiduciary investors-public/corporate pensions, endowments, insurers, sovereign funds-set mandates and allocate at scale. They can anchor new funds, seed place-based vehicles, and influence market norms by requiring credible impact management.',
      capacitiesLong:[
        'Scale & duration: ability to commit sizable tickets with long holding periods.',
        'Governance influence: policy engagement and convening power with managers and peers.',
        'Portfolio construction: allocate across public/private markets to match risk/return and impact goals.'
      ],
      challenges:[
        'Fiduciary interpretation and board education slow adoption of non-traditional structures.',
        'Need for track record and pipeline at scale to justify allocation.',
        'Operational capacity to manage bespoke impact mandates.'
      ],
      deps:[
        {id:'fund_managers', why:'Intermediated access and portfolio management.'},
        {id:'impact_mm', why:'Standardized metrics and independent verification.'},
        {id:'policy', why:'Regulatory clarity on fiduciary duty and disclosure.'},
        {id:'prof_services', why:'Legal/tax structuring and governance.'},
        {id:'intermediaries', why:'Platforms and syndication for access.'}
      ],
      subcats:[
        {title:'Pension Funds', mini:'Public & corporate retirement assets', bullets:['Liability-driven investing','Scale anchor commitments','Preference for established managers']},
        {title:'Endowments', mini:'University & foundation pools', bullets:['Long horizons','Mission alignment debates','Growing place-based side pockets']},
        {title:'Insurance', mini:'General accounts & impact sidecars', bullets:['Long-duration assets','Regulatory constraints','Risk-based capital considerations']}
      ]
    },
    { id:'foundations', seg:'supply', fn:['provision'],
      title:'Foundations & Philanthropies', meta:'Mission-aligned, flexible capital',
      keyFunction:'Bridge grants and investments with flexible tools (e.g., PRIs, guarantees).',
      descLong:'Mission-first capital that can absorb risk, fund pre-investment readiness, and crowd in others through guarantees or first-loss. Foundations often underwrite ecosystem costs (measurement, TA) and catalyze place-based strategies alongside grants.',
      capacitiesLong:[
        'Catalytic risk-taking: PRIs, recoverable grants, guarantees.',
        'Mission stewardship with community priorities.',
        'Ecosystem funding: willingness to cover TA and measurement.'
      ],
      challenges:[
        'Tension between grant-making and investing disciplines.',
        'Limited investment staff for direct deals.',
        'Board risk appetite and exit timing expectations.'
      ],
      deps:[
        {id:'ta_providers', why:'Funding for readiness and post-investment support.'},
        {id:'cdfi', why:'Community lending channels and local reach.'},
        {id:'impact_mm', why:'Shared learning and accountability on outcomes.'},
        {id:'ecosystem_builders', why:'Networks to coordinate actors.'}
      ]
    },
    { id:'gov_supply', seg:'supply', fn:['provision'],
      title:'Government & Public Funding', meta:'Policy, incentives, catalytic capital',
      keyFunction:'Create policy frameworks, tax incentives, and guarantees that de-risk private capital.',
      descLong:'Public agencies shape market rules and supply catalytic instruments (e.g., tax credits, guarantees, direct programs) that unlock private investment into priority sectors.',
      capacitiesLong:[
        'Regulatory authority to clarify rules and reporting.',
        'Incentive design to mobilize private capital.',
        'Countercyclical capital during market stress.'
      ],
      challenges:[
        'Administrative complexity and compliance burden.',
        'Policy cycles and reauthorizations create uncertainty.',
        'Coordination across agencies and levels of government.'
      ],
      deps:[
        {id:'policy', why:'Statutory and regulatory frameworks (e.g., CRA, tax credits).'},
        {id:'cdfi', why:'Program delivery into underserved markets.'},
        {id:'fund_managers', why:'Co-investment and market uptake.'},
        {id:'prof_services', why:'Program structuring and compliance support.'}
      ]
    },
    { id:'hnwi', seg:'supply', fn:['provision'],
      title:'HNW & Individual Investors', meta:'Flexible, values-aligned capital',
      keyFunction:'Provide flexible early-stage/values-aligned capital.',
      descLong:'Family offices and individuals fund seed-stage ventures, place-based efforts, and niche strategies. They often move quickly and can blend philanthropy with investment to prove concepts and attract later capital.',
      capacitiesLong:[
        'Speed & flexibility for bespoke terms.',
        'Operator experience and networks.',
        'Signaling effect for new managers or models.'
      ],
      challenges:[
        'Sourcing and diligence capacity vary widely.',
        'Liquidity needs may shorten horizons.',
        'Concentration risk without diversified vehicles.'
      ],
      deps:[
        {id:'vc_funds', why:'Access to early-stage pipelines and syndicates.'},
        {id:'fund_managers', why:'Diversification and professional oversight.'},
        {id:'intermediaries', why:'Platform access and custody/administration.'},
        {id:'ta_providers', why:'De-risking via investee readiness.'}
      ]
    },
    { id:'banks_supply', seg:'supply', fn:['provision','execution'],
      title:'Banks & Financial Institutions', meta:'Debt capital & banking',
      keyFunction:'Provide lending and banking services adapted for impact.',
      descLong:'Banks, credit unions and community banks supply credit and treasury services, often in partnership with CDFIs and public programs. They can mainstream impact through underwriting, community reinvestment, and specialized lending desks.',
      capacitiesLong:[
        'Underwriting and risk management infrastructure.',
        'Local branch networks and data for credit decisions.',
        'Access to public programs and secondary markets.'
      ],
      challenges:[
        'Regulatory capital and compliance constraints.',
        'Limited equity risk appetite.',
        'Measuring non-financial outcomes within prudential rules.'
      ],
      deps:[
        {id:'cdfi', why:'Participations and referrals in underserved markets.'},
        {id:'policy', why:'CRA, tax credits, and guarantee programs.'},
        {id:'prof_services', why:'Complex deal structuring and opinions.'},
        {id:'tech_platforms', why:'Loan origination, KYC/AML, portfolio systems.'}
      ],
      subcats:[
        {title:'Commercial Banks', mini:'Deposit-taking lenders', bullets:['Term loans & revolvers','Construction/permanent debt','Treasury services']},
        {title:'Credit Unions', mini:'Member-owned depositories', bullets:['Consumer/small business loans','Local presence & trust','Often CDFI-certified']},
        {title:'Investment Banks', mini:'Capital markets & advisory', bullets:['Underwriting & distribution','Syndication networks','M&A and structuring']}
      ]
    },

    // AGGREGATORS
    { id:'fund_managers', seg:'aggs', fn:['origination','execution'],
      title:'Impact Fund Managers', meta:'Source, diligence, manage',
      keyFunction:'Professional investment management with impact focus.',
      descLong:'Specialist managers pool capital, originate and structure deals, govern portfolio companies, and manage impact performance using recognized standards.',
      capacitiesLong:[
        'Sourcing engines and sector expertise.',
        'Impact management systems and verification.',
        'Active ownership and value-creation playbooks.'
      ],
      challenges:[
        'Fundraising in competitive markets; exits.',
        'Data collection burden on small investees.',
        'Attracting and retaining experienced, diverse talent.'
      ],
      deps:[
        {id:'inst_owners', why:'Anchor commitments and mandate design.'},
        {id:'foundations', why:'Catalytic tranches and TA funding.'},
        {id:'ta_providers', why:'Readiness and post-investment support.'},
        {id:'impact_mm', why:'Metrics, benchmarks, and assurance.'}
      ]
    },
    { id:'cdfi', seg:'aggs', fn:['origination','execution','opportunity'],
      title:'CDFIs (Community Lenders)', meta:'Mission lenders & TA',
      keyFunction:'Bridge mainstream finance and underserved communities.',
      descLong:'Certified community lenders deploy flexible debt and development services in low-income markets, blending public awards, bank capital, and philanthropy to meet local needs.',
      capacitiesLong:[
        'Place-based trust and relationships.',
        'Flexible underwriting and patient capital.',
        'Embedded technical assistance to borrowers.'
      ],
      challenges:[
        'Raising unrestricted and long-term capital.',
        'Regulatory and reporting burdens across programs.',
        'Balancing mission with portfolio risk.'
      ],
      deps:[
        {id:'gov_supply', why:'Program awards, tax credits, and guarantees.'},
        {id:'banks_supply', why:'Participations and CRA-motivated capital.'},
        {id:'foundations', why:'First-loss and operating grants.'},
        {id:'ta_providers', why:'Pre/post-loan support for borrowers.'}
      ]
    },
    { id:'dfi', seg:'aggs', fn:['provision','execution'],
      title:'Development Finance Institutions (DFIs)', meta:'Catalytic & risk mitigation',
      keyFunction:'Deploy public resources to crowd in private capital.',
      descLong:'Bilateral and multilateral DFIs provide debt, equity, and risk-sharing instruments in emerging markets, aiming to mobilize private finance into priority sectors while maintaining development additionality.',
      capacitiesLong:[
        'Political risk tools and concessional windows.',
        'Safeguards and standards for co-investors.',
        'Scale to anchor complex blended structures.'
      ],
      challenges:[
        'Bureaucratic timelines and mandate constraints.',
        'Balancing development impact with financial sustainability.',
        'Crowding-in measurement and transparency expectations.'
      ],
      deps:[
        {id:'inst_owners', why:'Co-investment and fund-of-funds participation.'},
        {id:'fund_managers', why:'Local sourcing and execution partners.'},
        {id:'policy', why:'Country/sector regulatory environment.'}
      ]
    },
    { id:'intermediaries', seg:'aggs', fn:['origination','execution'],
      title:'Investment Platforms & Intermediaries', meta:'Matchmaking & rails',
      keyFunction:'Enable efficient capital allocation via tech and networks.',
      descLong:'Platforms, broker-dealers, syndication networks, and funds-of-funds connect capital to opportunities, provide custody/administration, and streamline transactions.',
      capacitiesLong:[
        'Distribution networks and investor onboarding.',
        'Regulatory/compliance expertise.',
        'Workflow automation to reduce costs.'
      ],
      challenges:[
        'Maintaining quality control at scale.',
        'Unit economics in niche markets.',
        'Multi-jurisdiction compliance.'
      ],
      deps:[
        {id:'hnwi', why:'Retail and family-office demand.'},
        {id:'inst_owners', why:'Institutional flows and mandates.'},
        {id:'tech_platforms', why:'APIs, data, and transaction systems.'}
      ]
    },
    { id:'private_debt', seg:'aggs', fn:['execution'],
      title:'Private Debt Funds', meta:'Specialized credit',
      keyFunction:'Provide flexible debt to impact sectors.',
      descLong:'Specialist lenders underwrite working capital, project finance, and revenue-based structures aligned to impact outcomes (e.g., SME lending, real assets).',
      capacitiesLong:[
        'Credit underwriting and collateral structuring.',
        'Servicing and monitoring for smaller borrowers.',
        'Syndication with banks/CDFIs for scale.'
      ],
      challenges:[
        'Loss reserve needs and funding cost pressures.',
        'Data collection for outcome-linked features.',
        'Liquidity in down markets.'
      ],
      deps:[
        {id:'banks_supply', why:'Co-lending and warehousing.'},
        {id:'cdfi', why:'Local sourcing and servicing partnerships.'},
        {id:'impact_mm', why:'Target outcomes and reporting.'}
      ]
    },
    { id:'pe_funds', seg:'aggs', fn:['origination','execution'],
      title:'Private Equity Funds', meta:'Control/growth capital',
      keyFunction:'Invest in private companies for growth/impact.',
      descLong:'Buyout and growth equity investors scale proven models, improve operations and governance, and pursue impact value creation across supply chains, workforce, and products.',
      capacitiesLong:[
        'Operational improvement and governance levers.',
        'Value-creation planning with management teams.',
        'Follow-on capital for scaling.'
      ],
      challenges:[
        'Exit pathways in impact-sensitive sectors.',
        'Embedding impact in 100-day plans.',
        'Measuring enterprise-level outcomes.'
      ],
      deps:[
        {id:'inst_owners', why:'Large commitments and co-invests.'},
        {id:'prof_services', why:'Transaction, legal, and ESG diligence.'},
        {id:'impact_mm', why:'Impact KPIs and assurance.'}
      ]
    },
    { id:'vc_funds', seg:'aggs', fn:['origination','execution'],
      title:'Venture Capital Funds', meta:'Early-stage capital',
      keyFunction:'Finance startups in high-growth, impact-aligned sectors.',
      descLong:'Seed to Series investors back innovation where technology and new business models can deliver outsized impact (e.g., climate tech, health equity, edtech).',
      capacitiesLong:[
        'Sourcing via accelerators/universities/operators.',
        'Company-building and governance support.',
        'Syndication and staged financing discipline.'
      ],
      challenges:[
        'High failure rates and down-round risks.',
        'Impact measurement fit for early-stage realities.',
        'Founder diversity and access to networks.'
      ],
      deps:[
        {id:'hnwi', why:'Angel and family-office commitments.'},
        {id:'inst_owners', why:'Fund-of-funds and institutional LPs.'},
        {id:'ta_providers', why:'Accelerators and incubators for pipeline.'}
      ]
    },
    { id:'mfi', seg:'aggs', fn:['origination','execution'],
      title:'Microfinance Institutions', meta:'Micro-loans & services',
      keyFunction:'Provide small loans and adjacent services in underserved markets.',
      descLong:'MFIs extend micro-credit (and, at times, insurance and savings) to households and micro-enterprises that lack access to traditional banking, tailoring methodologies to local contexts.',
      capacitiesLong:[
        'High-touch origination and collections.',
        'Community presence and trust.',
        'Financial inclusion product design.'
      ],
      challenges:[
        'Unit economics and operating risk.',
        'Interest rate caps and regulatory changes.',
        'Digital transition and client protection.'
      ],
      deps:[
        {id:'foundations', why:'Capacity-building and first-loss capital.'},
        {id:'dfi', why:'Wholesale funding and risk-sharing.'},
        {id:'impact_mm', why:'Client outcomes and protection standards.'}
      ]
    },

    // SEEKERS
    { id:'social_enterprises', seg:'seek', fn:['opportunity'],
      title:'Social Enterprises & Impact Businesses', meta:'Execute impact models',
      keyFunction:'Create scalable solutions to social & environmental problems.',
      descLong:'Mission-driven companies deliver products/services that directly address social or environmental needs while targeting financial sustainability.',
      capacitiesLong:[
        'Innovation and user-centered design.',
        'Impact delivery embedded in the model.',
        'Ability to attract mission-aligned talent and partners.'
      ],
      challenges:[
        'Access to risk-tolerant growth capital.',
        'Go-to-market in underserved segments.',
        'Building credible impact evidence while scaling.'
      ],
      deps:[
        {id:'vc_funds', why:'Early-stage capital and guidance.'},
        {id:'fund_managers', why:'Growth funding and governance.'},
        {id:'ta_providers', why:'Investment readiness and post-investment support.'},
        {id:'impact_mm', why:'Metrics to validate outcomes.'}
      ]
    },
    { id:'community_orgs', seg:'seek', fn:['opportunity'],
      title:'Community Development Organizations', meta:'Place-based development',
      keyFunction:'Channel investment into community-controlled development.',
      descLong:'Local nonprofits and community-controlled entities develop affordable housing, main-street assets, and services with deep stakeholder engagement.',
      capacitiesLong:[
        'Community trust and governance legitimacy.',
        'Local knowledge of sites, stakeholders, and timelines.',
        'Coordinating multi-source capital stacks.'
      ],
      challenges:[
        'Complex financing across grants, credits, and loans.',
        'Capacity constraints in development and asset management.',
        'Extended timelines due to entitlement and community processes.'
      ],
      deps:[
        {id:'cdfi', why:'Flexible debt and TA.'},
        {id:'gov_supply', why:'Tax credits and public programs.'},
        {id:'foundations', why:'Predevelopment grants and guarantees.'},
        {id:'prof_services', why:'Legal, planning, and accounting.'},
        {id:'banks_supply', why:'Construction/permanent lending.'}
      ],
      subcats:[
        {title:'CDCs', mini:'Community Development Corporations', bullets:['Community ownership & voice','Neighborhood revitalization','Mixed financing (credits, grants, debt)']},
        {title:'Nonprofit Developers', mini:'Mission-first real estate developers', bullets:['Affordable housing/community facilities','Long-horizon stewardship','Complex capital stack management']},
        {title:'REITs (Affordable/Community)', mini:'Real estate investment trusts', bullets:['Own/operate income-producing assets','Aggregate capital at scale','Potential for mission-aligned mandates']}
      ]
    },
    { id:'real_estate', seg:'seek', fn:['opportunity'],
      title:'Real Estate Developers', meta:'Community infrastructure',
      keyFunction:'Transform capital into community infrastructure and housing.',
      descLong:'Developers deliver affordable and mixed-use projects that combine private, public, and philanthropic capital within regulatory frameworks.',
      capacitiesLong:[
        'Project finance and construction management.',
        'Entitlement and regulatory navigation.',
        'Partnerships with community organizations and lenders.'
      ],
      challenges:[
        'Layered capital stacks increase complexity.',
        'Interest rate and construction cost volatility.',
        'Long lead times and policy/market risk.'
      ],
      deps:[
        {id:'gov_supply', why:'LIHTC/NMTC tools and permits.'},
        {id:'banks_supply', why:'Construction and permanent loans.'},
        {id:'cdfi', why:'Gap financing and acquisition loans.'},
        {id:'prof_services', why:'Legal, tax, and cost engineering.'}
      ]
    },
    { id:'smb', seg:'seek', fn:['opportunity'],
      title:'Small Businesses & Entrepreneurs', meta:'Local jobs & wealth',
      keyFunction:'Drive local economic development and wealth building.',
      descLong:'SMEs create jobs and circulate wealth locally but often lack collateral and historic cashflows to access growth capital.',
      capacitiesLong:[
        'Proximity to customers and agility.',
        'Inclusive hiring and supplier potential.',
        'Digitization to formalize operations.'
      ],
      challenges:[
        'Collateral and credit history gaps.',
        'Business planning and financial management needs.',
        'Exposure to local shocks and cyclicality.'
      ],
      deps:[
        {id:'cdfi', why:'Flexible loans and TA.'},
        {id:'banks_supply', why:'Mainstream credit and treasury services.'},
        {id:'ta_providers', why:'Coaching on finance, operations, and sales.'}
      ]
    },
    { id:'nonprofits', seg:'seek', fn:['opportunity'],
      title:'Nonprofits (as capital users)', meta:'Program delivery',
      keyFunction:'Deploy grants/PRI-backed capital for mission outcomes.',
      descLong:'Nonprofits implement services and infrastructure that markets alone may not support, using recoverable grants, PRIs, and specialized loans.',
      capacitiesLong:[
        'Program expertise and stakeholder relationships.',
        'Ability to absorb catalytic capital tied to outcomes.',
        'Data on beneficiary needs and results.'
      ],
      challenges:[
        'Restricted funding and limited reserves.',
        'Complex reporting across funders.',
        'Scaling successful pilots into durable operations.'
      ],
      deps:[
        {id:'foundations', why:'Program funding and PRIs.'},
        {id:'gov_supply', why:'Contracts and public programs.'},
        {id:'impact_mm', why:'Outcomes frameworks and learning.'},
        {id:'ta_providers', why:'Financial management and earned-revenue planning.'}
      ]
    },

    // ENABLERS
    { id:'ta_providers', seg:'enab', fn:['opportunity'],
      title:'Technical Assistance Providers', meta:'Investment readiness',
      keyFunction:'Bridge the gap between capital supply and investment readiness.',
      descLong:'Advisors, accelerators, and incubators help enterprises upgrade governance, financials, sales, and impact practices to meet investor requirements.',
      capacitiesLong:[
        'Specialized coaching and domain expertise.',
        'Network access to investors and partners.',
        'Tailored support pre- and post-investment.'
      ],
      challenges:[
        'Fragmented funding models for quality TA.',
        'Consistency and standards of delivery.',
        'Geographic reach outside major hubs.'
      ],
      deps:[
        {id:'foundations', why:'Grant funding for TA programs.'},
        {id:'fund_managers', why:'Sourcing cohorts and success metrics.'},
        {id:'ecosystem_builders', why:'Shared programming and referrals.'},
        {id:'tech_platforms', why:'Tools for diagnostics and tracking.'}
      ]
    },
    { id:'ecosystem_builders', seg:'enab', fn:['opportunity','origination'],
      title:'Ecosystem Builders & Networks', meta:'Connectivity & advocacy',
      keyFunction:'Create connective tissue and collective capacity.',
      descLong:'Networks, associations, and conveners share knowledge, set norms, and advocate for enabling policy; they are multipliers for trust and coordination.',
      capacitiesLong:[
        'Relationship brokering and coalition-building.',
        'Knowledge aggregation and field guidance.',
        'Neutral convening across public/private/community actors.'
      ],
      challenges:[
        'Sustaining engagement and funding.',
        'Translating convenings into execution.',
        'Inclusive participation beyond usual suspects.'
      ],
      deps:[
        {id:'inst_owners', why:'Signal-setting and sponsorship.'},
        {id:'gov_enab', why:'Policy dialogues and programs.'},
        {id:'ta_providers', why:'Shared programming and pipelines.'},
        {id:'policy', why:'Evidence to inform rulemaking.'}
      ]
    },
    { id:'prof_services', seg:'enab', fn:['execution'],
      title:'Professional Services', meta:'Specialized transaction expertise',
      keyFunction:'Enable complex transactions with expertise.',
      descLong:'Law, accounting, banking, evaluation and consulting providers reduce completion risk, ensure compliance, and strengthen governance and reporting.',
      capacitiesLong:[
        'Regulatory knowledge and technical opinions.',
        'Process efficiency and documentation quality.',
        'Independent assurance and evaluation.'
      ],
      challenges:[
        'Costs can exclude smaller deals and early-stage actors.',
        'Limited impact fluency among some providers.',
        'Capacity constraints during market upcycles.'
      ],
      deps:[
        {id:'fund_managers', why:'Repeat transactions and mandates.'},
        {id:'inst_owners', why:'Policy and governance expectations.'},
        {id:'impact_mm', why:'Assurance and evaluation methodologies.'},
        {id:'intermediaries', why:'Execution platforms and distribution.'}
      ]
    },
    { id:'gov_enab', seg:'enab', fn:['execution','opportunity'],
      title:'Government & Public Agencies (enablers)', meta:'Incentives & programs',
      keyFunction:'Provide credits, guarantees, and programs; shape enabling environment.',
      descLong:'Agencies design and administer instruments that reduce risk and build markets, often partnering with CDFIs, banks, and fund managers to deliver capital.',
      capacitiesLong:[
        'Program design and regulatory enforcement.',
        'Targeting tools to reach underserved groups and places.',
        'Data access to guide and evaluate interventions.'
      ],
      challenges:[
        'Administrative load for applicants/awardees.',
        'Multi-year budget and authorization constraints.',
        'Inter-agency coordination and consistency.'
      ],
      deps:[
        {id:'policy', why:'Statutes, rules, and guidance.'},
        {id:'cdfi', why:'Local delivery capacity.'},
        {id:'banks_supply', why:'Credit channels and compliance.'},
        {id:'fund_managers', why:'Market adoption and scaling.'}
      ]
    },
    { id:'fintech', seg:'enab', fn:['origination','execution'],
      title:'Financial Services Technology', meta:'Digital enablement',
      keyFunction:'Improve and automate financial services delivery.',
      descLong:'Fintech providers deliver rails for onboarding, KYC/AML, payments, custody, and portfolio/impact reporting-lowering transaction costs and expanding access.',
      capacitiesLong:[
        'Scalable infrastructure and APIs.',
        'Data management and transparency.',
        'User experience that broadens participation.'
      ],
      challenges:[
        'Integration into legacy systems.',
        'Security and privacy requirements.',
        'Adoption in low-resource contexts.'
      ],
      deps:[
        {id:'intermediaries', why:'Distribution and embedding.'},
        {id:'tech_platforms', why:'Data standards and interoperability.'},
        {id:'impact_mm', why:'Metrics capture and dashboards.'},
        {id:'banks_supply', why:'Core banking and payments.'}
      ]
    },

    // INFRASTRUCTURE
    { id:'impact_mm', seg:'infra', fn:['execution','opportunity'],
      title:'Impact Measurement & Management', meta:'Standards & tracking',
      keyFunction:'Enable accountability and performance management.',
      descLong:'Shared standards, metrics sets, and assurance practices allow investors and enterprises to articulate, measure, and compare results while reducing reporting burden.',
      capacitiesLong:[
        'Common language for goals, indicators, and evidence.',
        'Performance tracking and learning systems.',
        'Third-party verification and data quality.'
      ],
      challenges:[
        'Cost and capacity burden for smaller actors.',
        'Attribution and counterfactual challenges.',
        'Fragmented standards without interoperability.'
      ],
      deps:[
        {id:'fund_managers', why:'Portfolio data and performance targets.'},
        {id:'social_enterprises', why:'Enterprise-level outcomes data.'},
        {id:'dfi', why:'Safeguards and disclosure alignment.'},
        {id:'tech_platforms', why:'Data capture and dashboards.'}
      ]
    },
    { id:'policy', seg:'infra', fn:['execution','origination'],
      title:'Policy & Regulatory Framework', meta:'Market-shaping rules & incentives',
      keyFunction:'Create enabling environment for impact investing.',
      descLong:'Tax incentives, disclosure rules, and market regulations shape the viability, cost, and speed of impact transactions across sectors and geographies.',
      capacitiesLong:[
        'Incentives that crowd in private capital.',
        'Legal frameworks that protect stakeholders and ensure market integrity.',
        'Clarity that reduces risk and attracts long-term investment.'
      ],
      challenges:[
        'Political cycles and reauthorization risk.',
        'Complexity that can deter smaller participants.',
        'Potential unintended consequences requiring iteration.'
      ],
      deps:[
        {id:'gov_supply', why:'Legislative authority and program funding.'},
        {id:'banks_supply', why:'Prudential rules and community reinvestment.'},
        {id:'cdfi', why:'Certification and deployment channels.'},
        {id:'fund_managers', why:'Disclosure and reporting compliance.'}
      ]
    },
    { id:'tech_platforms', seg:'infra', fn:['execution','origination','opportunity'],
      title:'Technology Platforms', meta:'Digital rails & transparency',
      keyFunction:'Enable efficient capital deployment and management.',
      descLong:'Investment, data, and communications systems connect participants, lower cost-to-serve, and make performance and impact more transparent.',
      capacitiesLong:[
        'Transaction efficiency and straight-through processing.',
        'Data integration and governance for decision-making.',
        'Scalability to support ecosystem growth.'
      ],
      challenges:[
        'Vendor lock-in and interoperability gaps.',
        'Cybersecurity and privacy risks.',
        'Change management in low-tech environments.'
      ],
      deps:[
        {id:'intermediaries', why:'Distribution and orchestration.'},
        {id:'impact_mm', why:'Standards-aligned data models.'},
        {id:'banks_supply', why:'Payments and compliance rails.'},
        {id:'fund_managers', why:'Portfolio systems and LP reporting.'}
      ]
    },
  ],

  glossary: [
    { group:'Investment Tools (selected)', items:[
      { term:'Equity', def:'Ownership capital with upside through dividends or capital gains; patient but higher-risk.' },
      { term:'Debt', def:'Loans/bonds requiring repayment with interest; preserves ownership but affects cash flow.' },
      { term:'Guarantee', def:'Third-party promise to absorb losses on default, de-risking lenders and unlocking credit.' },
    ]},
    { group:'Asset Classes (selected)', items:[
      { term:'Bonds (incl. Green/Social)', def:'Debt securities, including labeled bonds whose proceeds fund environmental or social projects.' },
      { term:'Stocks', def:'Equity ownership in companies; traded on exchanges.' },
      { term:'Real Assets', def:'Physical assets like real estate and infrastructure.' },
      { term:'Commodities', def:'Tradable raw materials such as cocoa, gold, oil.' },
      { term:'Money Market & Cash', def:'Short-term instruments for liquidity.' },
      { term:'Crypto/Digital Assets', def:'Digitally-native assets on blockchains.' },
    ]},
  ],

  strategies: [
    {
      key:'divesting',
      title:'Divesting (Exclusions) + Reallocation',
      longDesc:'Exclude sectors or issuers misaligned with mission (e.g., fossil fuels, tobacco, weapons) and reallocate to aligned assets (e.g., climate solutions, community finance). Common in endowments, foundations, faith investors, and HNW portfolios.',
      stakeholders:['inst_owners','fund_managers','intermediaries','policy','prof_services'],
      cases:[
        {
          title:'University endowment excludes fossil fuels and reallocates',
          steps:[
            'Board updates Investment Policy Statement with exclusions, timeline, and monitoring.',
            'OCIO and managers implement screens and transition portfolios with tracking-error controls.',
            'Reallocate a portion to climate solutions (thematic funds/ETFs) and green/social bonds.',
            'Publish stewardship report and decarbonization KPIs.'
          ],
          instruments:['Exclusions policy','Screened public equity','Green/Social bonds','Thematic equity funds'],
          stakeholders:['inst_owners','fund_managers','intermediaries','impact_mm']
        },
        {
          title:'Health foundation: tobacco & alcohol screen + CDFI notes',
          steps:[
            'Adopt exclusions for tobacco/alcohol.',
            'Create a social bond sleeve in fixed income.',
            'Purchase CDFI community investment notes to fund community health projects.',
            'Report allocation and programmatic impacts annually.'
          ],
          instruments:['Screened equity/credit','Social bonds','CDFI notes'],
          stakeholders:['inst_owners','fund_managers','cdfi','prof_services']
        }
      ]
    },
    {
      key:'esg',
      title:'ESG Integration & Stewardship (under the Responsible umbrella)',
      longDesc:'Systematically consider financially material ESG risks/opportunities and use ownership rights (voting, engagement, escalation) to protect and enhance long-term value.',
      stakeholders:['inst_owners','fund_managers','prof_services','impact_mm','intermediaries'],
      cases:[
        {
          title:'Listed equities: active ownership on worker safety',
          steps:[
            'Set stewardship priorities and company-level KPIs.',
            'Engage; file/support shareholder proposals where needed.',
            'Vote proxies aligned to stewardship goals; escalate if progress stalls.',
            'Report outcomes to LPs with KPI movement.'
          ],
          instruments:['ESG integration','Stewardship & engagement','Proxy voting'],
          stakeholders:['fund_managers','impact_mm','prof_services']
        },
        {
          title:'Fixed income: green & social bond sleeve',
          steps:[
            'Define use-of-proceeds (UoP) criteria and SPO requirements.',
            'Allocate to green/social bond fund or SMA with sector limits.',
            'Track allocation/impact reporting and controversies.'
          ],
          instruments:['Green bonds','Social bonds','SPO/Framework'],
          stakeholders:['fund_managers','impact_mm']
        },
        {
          title:'Corporate lending: sustainability-linked loan (SLL)',
          steps:[
            'Negotiate KPIs/SPTs; set verification and margin ratchet.',
            'Monitor borrower performance and adjust pricing per SLL principles.',
            'Disclose performance and lessons learned to IC/board.'
          ],
          instruments:['SLL with KPI/SPT','3rd-party verification'],
          stakeholders:['banks_supply','fund_managers','prof_services']
        }
      ]
    },
    {
      key:'thematic',
      title:'Thematic Impact Investing',
      longDesc:'Proactively invest for measurable solutions in a chosen theme (e.g., climate/energy transition, health equity, inclusive entrepreneurship, gender). Typically implemented via private funds/vehicles or dedicated public strategies.',
      stakeholders:['inst_owners','fund_managers','banks_supply','prof_services','tech_platforms'],
      cases:[
        {
          title:'Climate: distributed solar fund using ITC & PPAs',
          steps:[
            'Commit to specialist solar/infra fund targeting C&I/municipal rooftops.',
            'Fund structures tax equity (ITC) partnerships; secures PPAs with offtakers.',
            'Project-level senior debt closes; construction proceeds.',
            'Track generation, avoided emissions, and community benefits.'
          ],
          instruments:['Tax equity (ITC)','Senior project debt','PPAs'],
          stakeholders:['inst_owners','fund_managers','banks_supply','prof_services']
        },
        {
          title:'VC: early-stage climate tech',
          steps:[
            'Select climate-tech VC with deep technical/IMM capability.',
            'Back seed/Series-A companies in storage, grid, low-carbon materials.',
            'Support follow-ons; measure contribution via usage/output metrics.'
          ],
          instruments:['VC fund','Co-invest rights'],
          stakeholders:['inst_owners','fund_managers','prof_services']
        },
        {
          title:'Gender lens private debt (2X-aligned)',
          steps:[
            'Commit to private credit fund with 2X Criteria.',
            'Provide TA facility/guarantee to expand pipeline.',
            'Track gender KPIs (leadership, workforce, access to capital, products).'
          ],
          instruments:['Private credit','Guarantee/LLR','TA facility'],
          stakeholders:['inst_owners','fund_managers','ta_providers','prof_services']
        }
      ]
    },
    {
      key:'place_based',
      title:'Place-Based Impact Investing',
      longDesc:'Deploy blended capital into a defined geography, aligning public programs, community lenders, banks, developers, and foundations.',
      stakeholders:['foundations','cdfi','banks_supply','community_orgs','real_estate','gov_supply','ecosystem_builders','ta_providers','impact_mm'],
      cases:[
        {
          title:'Affordable housing via LIHTC',
          steps:[
            'Developer secures LIHTC allocation; syndicator organizes equity.',
            'Bank provides construction/permanent loans.',
            'CDFI provides subordinate/community debt; foundation supports pre-development.',
            'Project delivers restricted affordable units; compliance/reporting ongoing.'
          ],
          instruments:['LIHTC equity','Senior bank debt','Subordinate/CDFI debt','Guarantees/PRIs'],
          stakeholders:['real_estate','community_orgs','banks_supply','cdfi','foundations','policy','prof_services']
        },
        {
          title:'Community facility with NMTC',
          steps:[
            'CDFI/CDE secures NMTC allocation; investor provides QEI.',
            'QLICI loans flow to project with below-market terms; leverage loan rounds out stack.',
            'Facility opens; CDE manages 7-year compliance and reporting.'
          ],
          instruments:['NMTC (QEI/QLICI)','Bank leverage loan','Grants/guarantees'],
          stakeholders:['cdfi','banks_supply','community_orgs','gov_supply','prof_services']
        },
        {
          title:'C-PACE retrofit of multifamily portfolio',
          steps:[
            'Program authorized by city/state; owner scopes energy measures.',
            'Private capital funds upgrades; repayment via property tax assessment.',
            'Energy savings/resilience metrics reported to program and investors.'
          ],
          instruments:['C-PACE assessment','Senior mortgage consent'],
          stakeholders:['banks_supply','community_orgs','gov_supply','prof_services']
        },
        {
          title:'Municipal green bond for water resilience',
          steps:[
            'City adopts green bond framework and obtains SPO/certification.',
            'Issues labeled bond to finance wastewater/stormwater upgrades.',
            'Annual allocation and impact reporting to investors.'
          ],
          instruments:['Green municipal bond','SPO/Framework'],
          stakeholders:['gov_supply','banks_supply','fund_managers','prof_services','impact_mm']
        },
        {
          title:'Inclusive SMB growth via CDFI fund',
          steps:[
            'Anchor investors seed loan fund; bank participates (often for CRA).',
            'TA providers prepare borrowers; blended LLR de-risks lending.',
            'Graduation pathway to bank credit over time.'
          ],
          instruments:['CDFI notes','Loan loss reserve/guarantee','TA grants'],
          stakeholders:['cdfi','banks_supply','inst_owners','ta_providers','community_orgs','gov_supply']
        }
      ]
    }
  ]
};

// ------------------ BUILD UI -------------------------------------------
var segMap = {}; dataV10.segments.forEach(function(s){ segMap[s.key]=s });
var fnMap = {}; dataV10.functions.forEach(function(f){ fnMap[f.key]=f });

var grid = document.getElementById('grid');

function buildColumns(){
  grid.innerHTML='';
  dataV10.segments.forEach(function(seg){
    var col=document.createElement('div');
    col.className='col';
    col.dataset.seg=seg.key;
    col.innerHTML = '<h3>'+seg.label+'</h3><p class="sub">Click a card to view role & relationships</p><div class="list"></div>';
    grid.appendChild(col);
    var list=col.querySelector('.list');
    dataV10.nodes.filter(function(n){return n.seg===seg.key}).forEach(function(n){
      var card=document.createElement('div');
      card.className='card';
      card.tabIndex=0;
      card.dataset.id=n.id;
      card.dataset.seg=n.seg;
      card.dataset.fn=(n.fn||[]).join(',');
      
      // Build function badges
      var badges = '';
      if(n.fn && n.fn.length){
        badges = '<div style="margin-top:4px">';
        n.fn.forEach(function(f){
          var letter = f==='provision'?'P' : f==='origination'?'O' : f==='execution'?'E' : 'D';
          badges += '<span class="badge" style="font-size:11px; padding:2px 5px; min-width:20px">'+letter+'</span> ';
        });
        badges += '</div>';
      }
      
      card.innerHTML = '<div class="title">'+n.title+'</div>' +
                       badges +
                       '<div class="meta">'+n.meta+'</div>';
      card.addEventListener('click', function(){ openNode(n.id) });
      card.addEventListener('keydown', function(e){ if(e.key==='Enter') openNode(n.id) });
      list.appendChild(card);
    });
  });
}

function functionLens(applyKey){
  var cards = grid.querySelectorAll('.card');
  cards.forEach(function(c){
    if(applyKey==='all'){ c.classList.remove('dim'); return; }
    var has = (c.dataset.fn||'').split(',').indexOf(applyKey)>=0;
    c.classList.toggle('dim', !has);
  });
}

var modal = document.getElementById('modal');
var modalTitle = document.getElementById('modalTitle');
var modalBody = document.getElementById('modalBody');
document.getElementById('closeModal').addEventListener('click', function(){ modal.classList.remove('open'); resetView() });
modal.addEventListener('click', function(e){ if(e.target===modal){ modal.classList.remove('open'); resetView() } });

function openNode(id){
  var n = dataV10.nodes.find(function(x){ return x.id===id });
  if(!n) return;
  var seg = segMap[n.seg];
  var fnBadges = (n.fn||[]).map(function(k){ return '<span class="badge">'+fnMap[k].label+'</span>' }).join(' ');

  var capList = '<ul class="p">'+ (n.capacitiesLong||n.capacities||[]).map(function(x){ return '<li>'+x+'</li>' }).join('') + '</ul>';
  var chList  = '<ul class="p">'+ (n.challenges||[]).map(function(x){ return '<li>'+x+'</li>' }).join('') + '</ul>';
  var depList = (n.deps||[]).map(function(d){
    var target = dataV10.nodes.find(function(x){ return x.id===d.id });
    var label = target ? target.title : d.id;
    return '<div class="p" style="display:flex;gap:8px;align-items:flex-start;"><button class="dep" data-id="'+d.id+'">'+label+'</button><div style="color:#4a5b8c">'+(d.why||'')+'</div></div>';
  }).join('');
  var subList = (n.subcats && n.subcats.length) ?
    '<div class="subgrid">' + n.subcats.map(function(s){
      var bullets = (s.bullets||[]).map(function(b){ return '<li>'+b+'</li>' }).join('');
      return '<div class="subcard"><h5>'+s.title+'</h5><div class="mini">'+(s.mini||'')+'</div><ul>'+bullets+'</ul></div>';
    }).join('') + '</div>' : '<div class="p" style="color:#6a789f">Not applicable.</div>';

  var html = ''
    + '<div class="block"><h4>Segment</h4><div class="p"><span class="badge" style="background:#e9f7ef;border-color:#bfe7cc;color:#0f4e27">'+seg.label+'</span></div></div>'
    + '<div class="block"><h4>Function Lens</h4><div class="p">'+fnBadges+'</div></div>'
    + '<div class="block"><h4>Key Function</h4><div class="p">'+(n.keyFunction||'')+'</div></div>'
    + '<div class="block"><h4>Description</h4><div class="p">'+(n.descLong||n.desc||'')+'</div></div>'
    + '<div class="block"><h4>Capacities</h4>'+capList+'</div>'
    + '<div class="block"><h4>Bottlenecks & Challenges</h4>'+chList+'</div>'
    + '<div class="block"><h4>Sub-categories</h4>'+subList+'</div>'
    + '<div class="block"><h4>Key Relationship Dependencies</h4>'+depList+'</div>';

  modalTitle.textContent = n.title;
  modalBody.innerHTML = html;
  modal.classList.add('open');

  // dependency chip clicks
  modalBody.querySelectorAll('.dep').forEach(function(btn){
    btn.addEventListener('click', function(){
      var targetId = btn.getAttribute('data-id');
      modal.classList.remove('open');
      setTimeout(function(){ openNode(targetId) }, 50);
      var tEl = grid.querySelector('.card[data-id="'+targetId+'"]');
      if(tEl) tEl.scrollIntoView({behavior:'smooth', block:'center'});
    });
  });
}

// Glossary builder
function buildGlossary(){
  var g = document.getElementById('glossary');
  g.innerHTML = '';
  dataV10.glossary.forEach(function(group){
    var block = document.createElement('div');
    block.className='block';
    block.innerHTML = '<h4>'+group.group+'</h4>';
    group.items.forEach(function(item){
      var line = document.createElement('div');
      line.className='p';
      line.innerHTML = '<span class="badge" style="margin-right:8px">'+item.term+'</span>'+item.def;
      block.appendChild(line);
    });
    g.appendChild(block);
  });
}

// Strategies builder
function buildStrategies(){
  var sList = document.getElementById('strategiesList');
  sList.innerHTML='';
  dataV10.strategies.forEach(function(s){
    var block = document.createElement('div');
    block.className='strategy';
    var desc = '<div class="desc">'+s.longDesc+'</div>';
    // Strategy-level actions (download all examples)
    var actions = '<div class="strategy-actions"><button class="btn" data-dl="'+s.key+'">Download Strategy Brief (PDF)</button></div>';

    // Stakeholders chips
    var chips = '<div class="chips">';
    s.stakeholders.forEach(function(id){
      var n = dataV10.nodes.find(function(x){ return x.id===id });
      if(!n) return;
      var segKey = n.seg;
      chips += '<button class="stake" data-id="'+n.id+'" data-seg="'+segKey+'">'+n.title+'</button>';
    });
    chips += '</div>';

    // Case studies
    var cases = (s.cases||[]).map(function(cs){
      var steps = cs.steps.map(function(t,i){
        return '<div class="box"><div class="step">Step '+(i+1)+'</div>'+t+'</div>';
      }).join('');
      var tags = (cs.instruments||[]).map(function(t){ return '<span class="badge">'+t+'</span>' }).join('');
      var stk = (cs.stakeholders||[]).map(function(id){
        var n = dataV10.nodes.find(function(x){ return x.id===id });
        return '<button class="stake" data-id="'+id+'" data-seg="'+(n?n.seg:'')+'">'+(n?n.title:id)+'</button>';
      }).join('');
      return '<div class="cs"><h4>'+cs.title+'</h4><div class="flow">'+steps+'</div><div class="tags" style="margin-top:8px">'+tags+'</div><div class="chips" style="margin-top:6px">'+stk+'</div></div>';
    }).join('');

    block.innerHTML = '<h3>'+s.title+'</h3>'+desc+actions+chips+cases;
    sList.appendChild(block);
  });

  // click handlers to open Map nodes
  sList.querySelectorAll('.stake').forEach(function(btn){
    btn.addEventListener('click', function(){
      var id = btn.getAttribute('data-id');
      switchView('map'); // switch to Map tab
      setTimeout(function(){ openNode(id) }, 50);
      var el = grid.querySelector('.card[data-id="'+id+'"]'); if(el) el.scrollIntoView({behavior:'smooth', block:'center'});
    });
  });

  // download strategy brief buttons
  sList.querySelectorAll('[data-dl]').forEach(function(btn){
    btn.addEventListener('click', function(){
      var key = btn.getAttribute('data-dl'); exportStrategy(key);
    });
  });
}

// Utilities for Strategy PDF
function classifyInstrument(name){
  var s = name.toLowerCase();
  if(s.includes('senior') && (s.includes('debt') || s.includes('loan'))) return {tier:'Senior Debt', color:'#1E2951'};
  if(s.includes('subordinate') || s.includes('mezz')) return {tier:'Subordinate/Mezz', color:'#6FBFB3'};
  if(s.includes('equity') || s.includes('tax equity') || s.includes('vc') || s.includes('private equity')) return {tier:'Equity / Tax Equity', color:'#D4AF37'};
  if(s.includes('guarantee') || s.includes('llr') || s.includes('first-loss') || s.includes('pri') || s.includes('grant')) return {tier:'Guarantees/Grants', color:'#0F7938'};
  if(s.includes('bond')) return {tier:'Bonds', color:'#1E2951'};
  if(s.includes('ppa')) return {tier:'Contracts/PPAs', color:'#6FBFB3'};
  if(s.includes('c-pace') || s.includes('pace')) return {tier:'Assessment Finance', color:'#6FBFB3'};
  return {tier:'Other Tools', color:'#9AA6D1'};
}

function buildCapitalStack(instruments){
  // Group by tier preserving order of typical seniority ladder
  var groups = {};
  (instruments||[]).forEach(function(n){
    var c = classifyInstrument(n);
    groups[c.tier] = groups[c.tier] || {color:c.color, items:[]};
    groups[c.tier].items.push(n);
  });
  var order = ['Senior Debt','Bonds','Assessment Finance','Subordinate/Mezz','Equity / Tax Equity','Guarantees/Grants','Contracts/PPAs','Other Tools'];
  var html = order.filter(function(key){return groups[key]}).map(function(key){
    var g = groups[key];
    return '<div style="border-left:5px solid '+g.color+';background:#f8fafc;border:1px solid #e5e7eb;border-left-color:'+g.color+';padding:8px;border-radius:8px;margin:6px 0"><strong>'+key+':</strong> '+g.items.join(' â€¢ ')+'</div>';
  }).join('');
  return html || '<div style="color:#6B7280">Add instruments to display an illustrative stack.</div>';
}

function buildDependencies(caseStakeholderIds){
  // For each stakeholder in the case, show dependencies that point to another stakeholder in the case
  var lines = [];
  (caseStakeholderIds||[]).forEach(function(aId){
    var a = dataV10.nodes.find(function(x){return x.id===aId}); if(!a || !a.deps) return;
    a.deps.forEach(function(d){
      if((caseStakeholderIds||[]).indexOf(d.id)>=0){
        var b = dataV10.nodes.find(function(x){return x.id===d.id});
        var aName = a ? a.title : aId;
        var bName = b ? b.title : d.id;
        lines.push('<li><strong>'+aName+' â†’ '+bName+':</strong> '+(d.why||'')+'</li>');
      }
    });
  });
  if(!lines.length) return '<div style="color:#6B7280">No direct dependencies captured among the selected stakeholders.</div>';
  return '<ul>'+lines.join('')+'</ul>';
}

function programNotes(instruments){
  var s = (instruments||[]).join(' ').toLowerCase();
  var notes = [];
  if(s.includes('lihtc')){
    notes.push('<li><strong>LIHTC basics:</strong> federal tax credit administered by Treasury/IRS, typically allocated by State HFAs; investors receive credits for financing affordable rental housing. See HUD and IRS resources.</li>');
  }
  if(s.includes('nmtc')){
    notes.push('<li><strong>NMTC basics:</strong> investors make <em>Qualified Equity Investments (QEI)</em> into <em>Community Development Entities (CDEs)</em> and receive a 39% federal tax credit claimed over 7 years. See CDFI Fund.</li>');
  }
  if(s.includes('green bond') || s.includes('social bond')){
    notes.push('<li><strong>Labeled bonds:</strong> use-of-proceeds aligned to <em>ICMA Principles</em> with external review (e.g., SPO) and allocation & impact reporting.</li>');
  }
  if(s.includes('sll')){
    notes.push('<li><strong>Sustainability-Linked Loans (SLL):</strong> margin ratchets tied to KPIs/SPTs; follow LMA/ICMA SLL Principles and Guidance.</li>');
  }
  if(s.includes('c-pace') || s.includes('pace')){
    notes.push('<li><strong>C-PACE:</strong> private capital repaid via a property tax assessment; requires state/local enabling legislation and senior lender consent in many markets. See DOE/EPA toolkits.</li>');
  }
  if(s.includes('ppa') || s.includes('itc') || s.includes('tax equity')){
    notes.push('<li><strong>Energy ITC / PPAs:</strong> tech-neutral Â§48/Â§48E rules and standard PPA contracting support distributed solar economics; check IRS/DOE and SEIA resources.</li>');
  }
  if(!notes.length) return '';
  return '<div style="margin-top:8px"><h3 style="font-size:16px;color:#1E2951;margin:8px 0 4px">Program & Terminology Notes</h3><ul>'+notes.join('')+'</ul></div>';
}

// Strategy PDF (printable) - compiles *all* cases within a strategy with richer boxes
function exportStrategy(key){
  var s = dataV10.strategies.find(function(x){ return x.key===key }); if(!s) return;
  var now = new Date();
  var dateStr = now.toLocaleDateString(undefined, {year:'numeric', month:'short', day:'numeric'});

  var casesHtml = (s.cases||[]).map(function(cs, idx){
    var steps = cs.steps.map(function(t,i){
      return '<div style="border:1px solid #e5e7eb;border-radius:10px;padding:10px;margin:6px 0;background:#f7fbfb"><span style="background:#0F7938;color:#fff;border-radius:6px;padding:2px 8px;font-weight:700;margin-right:8px">Step '+(i+1)+'</span>'+t+'</div>';
    }).join('');

    var instruments = (cs.instruments||[]).map(function(x){ return '<span style="display:inline-block;margin:2px 6px 2px 0;padding:6px 10px;border-radius:999px;border:1px solid #e5e7eb;background:#fff">'+x+'</span>' }).join('');

    // Build dependencies (who depends on whom and why) using case stakeholders + node deps
    var depsHtml = buildDependencies(cs.stakeholders||[]);

    // Build an illustrative capital stack from instruments
    var stackHtml = buildCapitalStack(cs.instruments||[]);

    // Stakeholders chip row
    var stks = (cs.stakeholders||[]).map(function(id){
      var n = dataV10.nodes.find(function(x){ return x.id===id }); return '<span class="chip">'+(n?n.title:id)+'</span>';
    }).join(' ');

    // Extra program notes
    var extra = programNotes(cs.instruments||[]);

    return (
      '<section style="break-inside:avoid;margin:18px 0;padding:12px;border:1px solid #e5e7eb;border-radius:12px;background:linear-gradient(135deg, rgba(15,121,56,.04), rgba(31,41,81,.03))">'+
        '<h2 style="font-size:18px;margin:0 0 8px;color:#1E2951">'+cs.title+'</h2>'+
        '<div style="margin:6px 0 10px"><strong>Stakeholders:</strong> '+stks+'</div>'+

        '<div style="display:grid;grid-template-columns:1.1fr .9fr;gap:14px">'+
          // Left column: Key Steps + Program Notes
          '<div>'+
            '<div style="border-left:6px solid #0F7938;background:#f4fbf6;border:1px solid #c8ead8;border-left-color:#0F7938;padding:10px;border-radius:10px">'+
              '<h3 style="margin:0 0 6px;color:#0F7938">Key Steps</h3>'+ steps +
            '</div>'+
            extra +
          '</div>'+
          // Right column: Capital Stack + Dependencies
          '<div>'+
            '<div style="border-left:6px solid #D4AF37;background:#fffcf2;border:1px solid #f0e4b6;border-left-color:#D4AF37;padding:10px;border-radius:10px">'+
              '<h3 style="margin:0 0 6px;color:#8a6b05">Illustrative Capital Stack</h3>'+ stackHtml +
              '<div style="margin-top:8px"><strong>Instruments:</strong> '+instruments+'</div>'+
            '</div>'+
            '<div style="margin-top:10px;border-left:6px solid #6FBFB3;background:#f2fbfa;border:1px solid #cfe9e6;border-left-color:#6FBFB3;padding:10px;border-radius:10px">'+
              '<h3 style="margin:0 0 6px;color:#0a5b5d">Who depends on whom (and why)</h3>'+ depsHtml +
            '</div>'+
          '</div>'+
        '</div>'+
      '</section>'
    );
  }).join('');

  // Pull a quick "instrument index" for the header
  var instrumentIndex = [];
  (s.cases||[]).forEach(function(cs){
    (cs.instruments||[]).forEach(function(i){ if(instrumentIndex.indexOf(i)<0) instrumentIndex.push(i) });
  });
  var instrumentBadges = instrumentIndex.map(function(i){ return '<span class="chip">'+i+'</span>'; }).join(' ');

  var html = '<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">'+
  '<title>'+s.title+' - Strategy Brief</title>'+
  '<link href="https://fonts.googleapis.com/css2?family=Familjen+Grotesk:wght@400;600;700&display=swap" rel="stylesheet">'+
  '<style> :root{ --green:#0F7938; --blue:#1E2951; --yellow:#D4AF37; --light:#6FBFB3; --ink:#1E2951; --border:#e5e7eb; }'+
  'html,body{margin:0;background:#fff;color:var(--ink);font-family:"Familjen Grotesk",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;}' +
  '.wrap{max-width:980px;margin:0 auto;padding:0 0 30px} .chip{padding:4px 8px;border:1px solid var(--border);border-radius:999px;background:#f8fafc;font-weight:600;font-size:12px;margin-right:6px}'+
  '.cover{padding:24px 28px;background:linear-gradient(135deg, rgba(15,121,56,.10), rgba(31,41,81,.10)); border-bottom:4px solid var(--yellow)}'+
  '.hdr{display:flex;align-items:center;gap:10px} .dot{width:14px;height:14px;border-radius:50%;background:var(--green);box-shadow:0 0 0 6px rgba(15,121,56,.14)}'+
  'h1{margin:6px 0 4px;font-size:28px;color:var(--blue)} .muted{color:#6B7280} .k{font-weight:700;color:var(--blue)}'+
  '.sec{padding:16px 28px} .box{border:1px solid var(--border);border-radius:12px;padding:12px;margin-top:8px}'+
  '.grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}'+
  '@media print{ .noprint{display:none} }'+
  'a{color:#0a5b5d;text-decoration:none;border-bottom:1px dotted #6FBFB3}'+
  '</style></head><body>'+
  '<div class="wrap">'+
    '<div class="cover">'+
      '<div class="hdr"><div class="dot"></div><div style="font-weight:700;letter-spacing:.2px;color:var(--blue)">Impact Investing Ecosystem - Strategy Brief</div></div>'+
      '<h1>'+s.title+'</h1>'+
      '<div class="muted">Generated '+dateStr+' â€¢ Brand colors: <span style="color:var(--green)">#0F7938</span>, <span style="color:var(--blue)">#1E2951</span>, <span style="color:var(--yellow)">#D4AF37</span>, <span style="color:var(--light)">#6FBFB3</span></div>'+
      '<p style="margin-top:10px">'+(s.longDesc||'')+'</p>'+
      '<div class="box"><span class="k">Instruments you may see in this strategy:</span><br>'+instrumentBadges+'</div>'+
    '</div>'+

    '<div class="sec">'+
      '<h2 style="font-size:18px;margin:0 0 6px">Stakeholders involved (from the Map)</h2>'+
      '<div>'+ (s.stakeholders||[]).map(function(id){ var n=dataV10.nodes.find(function(x){return x.id===id}); return '<span class="chip">'+(n?n.title:id)+'</span>' }).join('') +'</div>'+
    '</div>'+

    '<div class="sec">'+
      '<h2 style="font-size:18px;margin:0 0 6px">How the money moves - Examples</h2>'+
      casesHtml+
    '</div>'+

    '<div class="sec">'+
      '<h2 style="font-size:18px;margin:0 0 6px">Reference links</h2>'+
      '<div class="grid2">'+
        '<div class="box">'+
          '<h3 style="margin:0 0 6px;color:var(--blue)">Programs & Standards</h3>'+
          '<ul style="margin:6px 0 0 18px">'+
            '<li>LIHTC program basics - HUD & IRS</li>'+
            '<li>NMTC program - CDFI Fund</li>'+
            '<li>Green/Social Bonds - ICMA Principles & Guidance</li>'+
            '<li>Sustainability-Linked Loans - LMA/ICMA Guidance</li>'+
            '<li>C-PACE - DOE/EPA Toolkits</li>'+
            '<li>Energy ITC (Â§48/Â§48E) - IRS final rules; PPAs - SEIA</li>'+
          '</ul>'+
        '</div>'+
        '<div class="box">'+
          '<h3 style="margin:0 0 6px;color:var(--blue)">Housekeeping</h3>'+
          '<p class="muted">Customize steps, add dollar ranges and timelines, and paste local program URLs. Use your browserâ€™s <strong>Print</strong> to save this page as a PDF.</p>'+
          '<p class="noprint"><a href="#" onclick="window.print();return false;">Print to PDF</a></p>'+
        '</div>'+
      '</div>'+
    '</div>'+
  '</div></body></html>';

  var win = window.open('', '_blank');
  win.document.open(); win.document.write(html); win.document.close(); win.focus();
  setTimeout(function(){ try{win.print()}catch(e){} }, 500);
}

// Search across views
var q = document.getElementById('q');
q.addEventListener('input', function(){
  var term = q.value.trim().toLowerCase();
  // filter map cards
  grid.querySelectorAll('.card').forEach(function(card){
    var id=card.dataset.id;
    var node=dataV10.nodes.find(function(n){return n.id===id});
    var blob=(node.title+' '+(node.meta||'')+' '+(node.keyFunction||'')+' '+(node.descLong||node.desc||'')+' '+(node.capacitiesLong||node.capacities||[]).join(' ')+' '+(node.challenges||[]).join(' ')).toLowerCase();
    var hit = term==='' || blob.indexOf(term)>=0;
    card.style.display = hit? '' : 'none';
  });
  // filter glossary lines
  document.querySelectorAll('#glossary .block .p').forEach(function(d){
    var text=d.textContent.toLowerCase();
    d.style.display = term==='' || text.indexOf(term)>=0 ? '' : 'none';
  });
  // filter strategies text
  document.querySelectorAll('#strategiesList .strategy').forEach(function(d){
    var text=d.textContent.toLowerCase();
    d.style.display = term==='' || text.indexOf(term)>=0 ? '' : 'none';
  });
});

// Left nav
function switchView(view){
  document.querySelectorAll('aside .nav button').forEach(function(b){ b.classList.remove('active') });
  document.querySelector('aside .nav button[data-view="'+view+'"]').classList.add('active');
  document.querySelectorAll('.section').forEach(function(s){ s.classList.remove('active') });
  document.getElementById('view-'+view).classList.add('active');
  
  // Hide search/lens/legend when Georgia tab is active
  var searchEl = document.querySelector('aside .search');
  var lensEl = document.querySelector('aside .lens');
  var legendEl = document.querySelector('aside .legend');
  
  if(view === 'georgia') {
    if(searchEl) searchEl.style.display = 'none';
    if(lensEl) lensEl.style.display = 'none';
    if(legendEl) legendEl.style.display = 'none';
  } else {
    if(searchEl) searchEl.style.display = '';
    if(lensEl) lensEl.style.display = '';
    if(legendEl) legendEl.style.display = '';
  }
}
document.querySelectorAll('aside .nav button').forEach(function(btn){
  btn.addEventListener('click', function(){ switchView(btn.dataset.view) });
});

// Function lens chips
var lens = document.getElementById('lens');
lens.addEventListener('click', function(e){
  var chip = e.target.closest('.chip'); if(!chip) return;
  lens.querySelectorAll('.chip').forEach(function(c){ c.classList.remove('active') });
  chip.classList.add('active');
  functionLens(chip.dataset.fn);
});

// Export & How-to & Reset
document.getElementById('exportPrint').addEventListener('click', function(){ window.print() });

function resetView(){
  // Clear search, reset lens, show map view
  document.getElementById('q').value='';
  functionLens('all');
  document.querySelectorAll('.card').forEach(function(c){ c.classList.remove('dim'); c.style.display=''; });
  switchView('map');
  lens.querySelectorAll('.chip').forEach(function(c){ c.classList.remove('active') });
  lens.querySelector('.chip[data-fn="all"]').classList.add('active');
  window.scrollTo({top:0, behavior:'smooth'});
}
document.getElementById('resetView').addEventListener('click', function(){ resetView() });

document.getElementById('how').addEventListener('click', function(){
  var modal = document.getElementById('modal'); var modalTitle=document.getElementById('modalTitle'); var modalBody=document.getElementById('modalBody');
  modalTitle.textContent='How to use this explorer';
  modalBody.innerHTML = ''
    + '<div class="block"><h4>Explore roles</h4><div class="p">Open any card to see <em>Description</em>, <em>Capacities</em>, <em>Challenges</em>, <em>Sub-categories</em>, and <em>Dependencies</em>. Dependency chips jump to the related stakeholder.</div></div>'
    + '<div class="block"><h4>Function Lens</h4><div class="p">Use the chips to spotlight who does <strong>Provision</strong>, <strong>Origination</strong>, <strong>Execution</strong>, or <strong>Opportunity Development</strong>.</div></div>'
    + '<div class="block"><h4>Strategies</h4><div class="p">Open the <strong>Strategies</strong> tab to read step-by-step flows (â€œHow the money movesâ€) under each strategy-<strong>Divesting</strong>, <strong>ESG Integration & Stewardship</strong>, <strong>Thematic</strong>, and <strong>Place-Based</strong>. Click any stakeholder chip to jump back to the Map and open its details.</div></div>'
    + '<div class="block"><h4>Download</h4><div class="p">Use <strong>Download Strategy Brief</strong> to export a print-ready multi-case PDF using your brand font and colors. Each example includes <em>Key Steps</em>, an <em>Illustrative Capital Stack</em>, and <em>Who depends on whom (and why)</em>.</div></div>';
  modal.classList.add('open');
});

// Boot
buildColumns(); functionLens('all'); buildGlossary(); buildStrategies();

// Georgia tab initialization
function initGeorgiaTab() {
  // Stats data with SVG icons
  var stats = [
    {
      label: 'Capital Suppliers', 
      value: '82', 
      icon: '<svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm.31-8.86c-1.77-.45-2.34-.94-2.34-1.67 0-.84.79-1.43 2.1-1.43 1.38 0 1.9.66 1.94 1.64h1.71c-.05-1.34-.87-2.57-2.49-2.97V5H10.9v1.69c-1.51.32-2.72 1.3-2.72 2.81 0 1.79 1.49 2.69 3.66 3.21 1.95.46 2.34 1.15 2.34 1.87 0 .53-.39 1.39-2.1 1.39-1.6 0-2.23-.72-2.32-1.64H8.04c.1 1.7 1.36 2.66 2.86 2.97V19h2.34v-1.67c1.52-.29 2.72-1.16 2.73-2.77-.01-2.2-1.9-2.96-3.66-3.42z"/></svg>'
    },
    {
      label: 'Capital Aggregators', 
      value: '45', 
      icon: '<svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24"><path d="M12 2l-5.5 9h11L12 2zm0 3.84L13.93 9h-3.87L12 5.84zM17.5 13c-2.49 0-4.5 2.01-4.5 4.5s2.01 4.5 4.5 4.5 4.5-2.01 4.5-4.5-2.01-4.5-4.5-4.5zm0 7c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5zM3 21.5h8v-8H3v8zm2-6h4v4H5v-4z"/></svg>'
    },
    {
      label: 'Capital Enablers', 
      value: '29', 
      icon: '<svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>'
    },
    {
      label: 'Capital Seekers', 
      value: '48', 
      icon: '<svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24"><path d="M13 2.05v3.03c3.39.49 6 3.39 6 6.92 0 .9-.18 1.75-.48 2.54l2.6 1.53c.56-1.24.88-2.62.88-4.07 0-5.18-3.95-9.45-9-9.95zM12 19c-3.87 0-7-3.13-7-7 0-3.53 2.61-6.43 6-6.92V2.05c-5.06.5-9 4.76-9 9.95 0 5.52 4.47 10 9.99 10 3.31 0 6.24-1.61 8.06-4.09l-2.6-1.53C16.17 17.98 14.21 19 12 19z"/></svg>'
    }
  ];
  
  // Populate stats with SVG icons
  var statsContainer = document.getElementById('gaStats');
  if (statsContainer) {
    statsContainer.innerHTML = stats.map(function(s) {
      return '<div class="stat">' +
        '<div class="glyph">' + s.icon + '</div>' +
        '<div class="meta">' +
          '<div class="label">' + s.label + '</div>' +
          '<div class="value">' + s.value + '</div>' +
        '</div>' +
      '</div>';
    }).join('');
  }
}

// Initialize Georgia tab when DOM is ready
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', initGeorgiaTab);
} else {
  initGeorgiaTab();
}
</script>
</body>
</html>
